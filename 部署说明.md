# Ubuntu ç¿»è¯‘æœåŠ¡ä¸€é”®éƒ¨ç½²è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡å·¥ä½œ

ç¡®ä¿ä½ çš„UbuntuæœåŠ¡å™¨æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
- Ubuntu 18.04+ 
- è‡³å°‘2GBå†…å­˜
- è‡³å°‘10GBå¯ç”¨ç£ç›˜ç©ºé—´
- å…·æœ‰sudoæƒé™çš„ç”¨æˆ·

### 2. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

å°†ä½ çš„é¡¹ç›®æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä»»æ„ç›®å½•ï¼Œä¾‹å¦‚ï¼š

```bash
# æ–¹æ³•1: ä½¿ç”¨scpä¸Šä¼ 
scp -r /path/to/your/project user@your-server:~/

# æ–¹æ³•2: ä½¿ç”¨gitå…‹éš†
git clone your-repo-url ~/translation-project

# æ–¹æ³•3: ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•å¹¶ä¸Šä¼ æ–‡ä»¶
```

### 3. è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/your-project-directory

# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy-ubuntu.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo ./deploy-ubuntu.sh
```

### 4. æŒ‰æç¤ºè¾“å…¥é…ç½®ä¿¡æ¯

è„šæœ¬ä¼šæç¤ºä½ è¾“å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **Rediså¯†ç **: ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆéšæœºå¯†ç 
2. **ç™¾åº¦ç¿»è¯‘APP ID**: å¿…é¡»å¡«å†™ä½ çš„ç™¾åº¦ç¿»è¯‘APIçš„APP ID
3. **ç™¾åº¦ç¿»è¯‘SECRET KEY**: å¿…é¡»å¡«å†™ä½ çš„ç™¾åº¦ç¿»è¯‘APIçš„å¯†é’¥
4. **åŸŸå**: å¯é€‰ï¼Œç•™ç©ºå°†ä½¿ç”¨IPè®¿é—®

## ğŸ“ éƒ¨ç½²ç»“æ„

éƒ¨ç½²å®Œæˆåï¼Œé¡¹ç›®å°†å®‰è£…åœ¨ä»¥ä¸‹ä½ç½®ï¼š

```
/home/translation-service/          # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ main.py                         # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ config.py                       # é…ç½®ç®¡ç†
â”œâ”€â”€ cache.py                        # ç¼“å­˜ç®¡ç†
â”œâ”€â”€ translator.py                   # ç¿»è¯‘æœåŠ¡
â”œâ”€â”€ static/                         # é™æ€æ–‡ä»¶
â”œâ”€â”€ venv/                          # Pythonè™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ .env                           # ç¯å¢ƒé…ç½®æ–‡ä»¶
â”œâ”€â”€ gunicorn.conf.py               # Gunicorné…ç½®
â””â”€â”€ manage.sh                      # ç®¡ç†è„šæœ¬

/var/log/translation-service/       # æ—¥å¿—ç›®å½•
â”œâ”€â”€ access.log                     # è®¿é—®æ—¥å¿—
â””â”€â”€ error.log                      # é”™è¯¯æ—¥å¿—
```

## ğŸ”§ æœåŠ¡ç®¡ç†

### ä½¿ç”¨systemctlå‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start translation-service

# åœæ­¢æœåŠ¡
sudo systemctl stop translation-service

# é‡å¯æœåŠ¡
sudo systemctl restart translation-service

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status translation-service

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u translation-service -f

# å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable translation-service

# ç¦ç”¨å¼€æœºè‡ªå¯åŠ¨
sudo systemctl disable translation-service
```

### ä½¿ç”¨ç®¡ç†è„šæœ¬

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/translation-service

# ä½¿ç”¨ç®¡ç†è„šæœ¬
./manage.sh start      # å¯åŠ¨æœåŠ¡
./manage.sh stop       # åœæ­¢æœåŠ¡
./manage.sh restart    # é‡å¯æœåŠ¡
./manage.sh status     # æŸ¥çœ‹çŠ¶æ€
./manage.sh logs       # æŸ¥çœ‹æ—¥å¿—
./manage.sh test       # æµ‹è¯•APIåŠŸèƒ½
```

## ğŸŒ è®¿é—®æœåŠ¡

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®æœåŠ¡ï¼š

### ç›´æ¥è®¿é—®API (ç«¯å£9000)
```bash
# å¥åº·æ£€æŸ¥
curl http://your-server-ip:9000/health

# ç¿»è¯‘æµ‹è¯•
curl -X POST "http://your-server-ip:9000/api/translate" \
  -H "Content-Type: application/json" \
  -d '{"text":"Hello World","from_lang":"en","to_lang":"zh"}'
```

### é€šè¿‡Nginxä»£ç† (ç«¯å£80)
```bash
# å¥åº·æ£€æŸ¥
curl http://your-server-ip/health

# ç¿»è¯‘æµ‹è¯•
curl -X POST "http://your-server-ip/api/translate" \
  -H "Content-Type: application/json" \
  -d '{"text":"Hello World","from_lang":"en","to_lang":"zh"}'
```

### æµè§ˆå™¨è®¿é—®
- ä¸»é¡µ: `http://your-server-ip/`
- å¥åº·æ£€æŸ¥: `http://your-server-ip/health`
- APIæ–‡æ¡£: `http://your-server-ip/docs`

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ–¹æ³•1: ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬

```bash
# åœ¨é¡¹ç›®æºç ç›®å½•ä¸­è¿è¡Œ
chmod +x quick-deploy.sh
sudo ./quick-deploy.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨æ›´æ–°

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop translation-service

# å¤‡ä»½é…ç½®
sudo cp /home/translation-service/.env /tmp/.env.backup

# æ›´æ–°ä»£ç 
sudo cp -r /path/to/new/code/* /home/translation-service/

# æ¢å¤é…ç½®
sudo cp /tmp/.env.backup /home/translation-service/.env

# æ›´æ–°ä¾èµ–
sudo -u translation /home/translation-service/venv/bin/pip install -r /home/translation-service/requirements.txt

# é‡å¯æœåŠ¡
sudo systemctl start translation-service
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
sudo journalctl -u translation-service --no-pager -l

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo -u translation /home/translation-service/venv/bin/python -c "import main"

# æ£€æŸ¥ç«¯å£å ç”¨
sudo ss -tlnp | grep :9000
```

### 2. Redisè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥RedisçŠ¶æ€
sudo systemctl status redis-server

# æµ‹è¯•Redisè¿æ¥
redis-cli -a your_redis_password ping

# æŸ¥çœ‹Redisé…ç½®
sudo cat /etc/redis/redis.conf | grep requirepass
```

### 3. Nginxä»£ç†é—®é¢˜

```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 4. æƒé™é—®é¢˜

```bash
# ä¿®å¤æ–‡ä»¶æƒé™
sudo chown -R translation:translation /home/translation-service
sudo chmod -R 755 /home/translation-service
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# åº”ç”¨æ—¥å¿—
sudo tail -f /var/log/translation-service/error.log
sudo tail -f /var/log/translation-service/access.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u translation-service -f

# Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/translation-error.log
sudo tail -f /var/log/nginx/translation-access.log
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep gunicorn

# æŸ¥çœ‹ç«¯å£è¿æ¥
sudo ss -tlnp | grep :9000

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
free -h
df -h
```

## ğŸ”’ å®‰å…¨é…ç½®

### é˜²ç«å¢™è®¾ç½®

è„šæœ¬ä¼šè‡ªåŠ¨é…ç½®UFWé˜²ç«å¢™ï¼Œå¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
- 22 (SSH)
- 80 (HTTP)
- 443 (HTTPS)

### SSLè¯ä¹¦é…ç½® (å¯é€‰)

å¦‚æœä½ æœ‰åŸŸåï¼Œå¯ä»¥é…ç½®å…è´¹çš„Let's Encrypt SSLè¯ä¹¦ï¼š

```bash
# å®‰è£…certbot
sudo apt install certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. æ£€æŸ¥æœåŠ¡çŠ¶æ€: `sudo systemctl status translation-service`
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `sudo journalctl -u translation-service --no-pager -l`
3. æµ‹è¯•APIè¿æ¥: `curl http://localhost:9000/health`
4. æ£€æŸ¥é…ç½®æ–‡ä»¶: `/home/translation-service/.env`
5. éªŒè¯ä¾èµ–å®‰è£…: `/home/translation-service/venv/bin/pip list`

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ä½äº `/home/translation-service/.env`ï¼š

```bash
# Redisé…ç½®
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=your_password

# ç™¾åº¦ç¿»è¯‘API
BAIDU_APP_ID=your_app_id
BAIDU_SECRET_KEY=your_secret_key

# åº”ç”¨é…ç½®
DEBUG=false
LOG_LEVEL=INFO
```

ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯æœåŠ¡ï¼š
```bash
sudo systemctl restart translation-service
```
