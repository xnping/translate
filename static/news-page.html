<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="page-title">å¹¿è¥¿æ–°é—»ç½‘ - æœ€æ–°èµ„è®¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .main-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .news-header {
            border-bottom: 3px solid #1890ff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .news-title {
            font-size: 28px;
            font-weight: bold;
            color: #1a1a1a;
            margin-bottom: 15px;
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #666;
            font-size: 14px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .news-content {
            font-size: 16px;
            line-height: 1.8;
        }

        .content-paragraph {
            margin-bottom: 20px;
            text-indent: 2em;
        }

        .highlight-text {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .important-text {
            font-weight: bold;
            color: #d73527;
        }

        .quote-text {
            font-style: italic;
            color: #555;
            border-left: 4px solid #1890ff;
            padding-left: 15px;
            margin: 20px 0;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: bold;
            color: #1890ff;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .news-list {
            list-style: none;
        }

        .news-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .news-link {
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }

        .news-link:hover {
            color: #1890ff;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background-color: #f0f0f0;
            color: #666;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #1890ff;
            color: white;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #666;
        }

        /* ç¿»è¯‘è¡¨å•æ ·å¼ */
        .translate-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 20px;
            z-index: 1000;
        }

        .translate-title {
            font-size: 16px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 15px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .btn-translate {
            width: 100%;
            background-color: #52c41a;
            color: white;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-translate:hover {
            background-color: #389e0d;
        }

        .status-message {
            margin-top: 10px;
            padding: 6px;
            border-radius: 4px;
            font-size: 11px;
            display: none;
        }

        .status-success {
            background-color: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .status-error {
            background-color: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }

        .status-loading {
            background-color: #e6f7ff;
            color: #1890ff;
            border: 1px solid #91d5ff;
        }



    </style>
</head>
<body>
    <div class="container main-container">
        <main class="main-content news-main">
            <header class="news-header article-header">
                <h1 class="news-title main-title">å¹¿è¥¿å¤šéƒ¨é—¨è”åŠ¨å¼€å±•"ç‰µæ‰‹'ç«¥'è¡Œ"å…¬ç›Šè¡ŒåŠ¨</h1>
                <div class="news-meta article-meta">
                    <span class="meta-item source-info">
                        <strong class="label-text">æ¥æºï¼š</strong>
                        <span class="source-name">å¹¿è¥¿æ—¥æŠ¥</span>
                    </span>
                    <span class="meta-item date-info">
                        <strong class="label-text">æ—¶é—´ï¼š</strong>
                        <time class="publish-date" datetime="2025-05-29">2025.05.29 07:50</time>
                    </span>
                    <div class="action-buttons article-actions">
                        <button class="btn btn-primary share-btn" type="button">é€è‡³æ¥¼å±‚</button>
                        <button class="btn btn-secondary size-btn" type="button">å¤§</button>
                        <button class="btn btn-secondary size-btn" type="button">å°</button>
                        <button class="btn btn-secondary print-btn" type="button">æ‰“å°</button>
                    </div>
                </div>
            </header>

            <article class="news-content main-article">
                <p class="content-paragraph intro-paragraph">
                    åœ¨<strong class="important-text">"å…­ä¸€"å›½é™…å„¿ç«¥èŠ‚</strong>å³å°†åˆ°æ¥ä¹‹é™…ï¼Œç”±è‡ªæ²»åŒºæ°‘æ”¿å…ã€è‡ªæ²»åŒºé«˜çº§æ³•é™¢è”åˆè‡ªæ²»åŒº
                    <em class="emphasis-text">å¦‡è”ã€è‡ªæ²»åŒºæ•™è‚²å…ç­‰éƒ¨é—¨</em>å…±åŒä¸¾åŠçš„
                    <span class="highlight-text">"å¾®å¿ƒæ„¿æ”¶é›†ç‰µæ‰‹'ç«¥'è¡Œâ€”â€”2025å¹´'æ³¡å¿ƒ'ä¼´æˆé•¿åŒå¿ƒæŠ¤æœªæ¥"</span>
                    å…³çˆ±å„¿ç«¥ä¸»é¢˜å®£ä¼ æ´»åŠ¨ï¼Œæ—¥å‰åœ¨å—å®ä¸¾è¡Œã€‚
                </p>

                <p class="content-paragraph detail-paragraph">
                    æ´»åŠ¨é€šè¿‡<cite class="quote-reference">"å¾®å¿ƒæ„¿"</cite>è®¤é¢†ã€å„¿ç«¥æ–‡è‰ºå±•æ¼”ã€å®ˆæŠ¤æ•…äº‹åˆ†äº«ç­‰ç¯èŠ‚ï¼Œ
                    å±•ç°<mark class="highlight-mark">å¹¿è¥¿å…³çˆ±å†œæ‘ç•™å®ˆå„¿ç«¥ã€å›°å¢ƒå„¿ç«¥çš„åˆ›æ–°å®è·µä¸æš–å¿ƒæˆæœ</mark>ï¼Œ
                    å‡èšç¤¾ä¼šå„ç•ŒæŠ¤ç«¥æˆé•¿çš„åˆåŠ›ã€‚
                </p>

                <blockquote class="quote-text important-quote">
                    <p class="quote-content">
                        æ´»åŠ¨ç°åœºï¼Œ<span class="speaker-name">"å¾®å¿ƒæ„¿"</span>è®¤é¢†ç¯èŠ‚æˆä¸ºä¸€å¤§äº®ç‚¹ã€‚
                        <q class="inline-quote">"æƒ³è¦ä¸€ä¸ªæ–°ä¹¦åŒ…"</q>ã€<q class="inline-quote">"å¸Œæœ›æœ‰ä¸€æœ¬ã€Šç™¾ç§‘å…¨ä¹¦ã€‹"</q>ã€
                        <q class="inline-quote">"æ¢¦æƒ³æ‹¥æœ‰ä¸€ä¸ªç¯®çƒ"</q>â€¦â€¦
                    </p>
                </blockquote>

                <p class="content-paragraph description-paragraph">
                    è¿™äº›è´¨æœ´è€ŒçœŸæŒšçš„å¿ƒæ„¿ï¼Œæ‰¿è½½ç€<abbr title="å†œæ‘ç•™å®ˆå„¿ç«¥" class="abbreviation">ç•™å®ˆå„¿ç«¥</abbr>å’Œ
                    <abbr title="å›°å¢ƒå„¿ç«¥" class="abbreviation">å›°å¢ƒå„¿ç«¥</abbr>æœ€çœŸæŒšçš„æœŸç›¼ã€‚
                    è¿™äº›å¿ƒæ„¿å‡ç”±åŸºå±‚å„¿ç«¥å·¥ä½œè€…æ·±å…¥èµ°è®¿å¾é›†è€Œæ¥ï¼Œæ‰€éœ€ç‰©èµ„æ¶µç›–
                    <span class="category-list">å­¦ä¹ ç”¨å“ã€ä½“è‚²å™¨æã€ç”Ÿæ´»ç”¨å“</span>ç­‰ï¼Œ
                    æ¯ä¸ªå¿ƒæ„¿ä»·å€¼ä¸è¶…è¿‡<data value="300" class="price-data">300å…ƒ</data>ã€‚
                </p>

                <section class="content-section activity-section">
                    <h2 class="section-title sub-heading">æ´»åŠ¨äº®ç‚¹</h2>
                    <p class="content-paragraph highlight-paragraph">
                        åœ¨å„¿ç«¥æ–‡è‰ºå±•æ¼”ç¯èŠ‚ï¼Œå­©å­ä»¬ç”¨çº¯çœŸæ— é‚ªçš„è¡¨æ¼”å±•ç°å‡ºç§¯æå‘ä¸Šçš„ç²¾ç¥é£è²Œï¼Œ
                        èµ¢å¾—äº†<del class="correction-text">é˜µé˜µ</del><ins class="insert-text">çƒ­çƒˆ</ins>æŒå£°ã€‚
                        æ•…äº‹åˆ†äº«ç¯èŠ‚ä¸­ï¼Œ<small class="small-text">æ¥è‡ªå„è¡Œå„ä¸šçš„äººå‘˜åˆ†äº«äº†</small>
                        å®ˆæŠ¤å„¿ç«¥çš„åŠ¨äººæ•…äº‹ï¼Œè§è¯äº†å­¤å¯¡å®¶åº­<sup class="superscript">[1]</sup>
                        "ç‰µæ‰‹'ç«¥'è¡Œ"çš„æ¸©é¦¨åœºæ™¯ï¼Œä¹Ÿçœ‹åˆ°äº†çˆ±å¿ƒä¼ä¸šå’Œè¡ŒåŠ¨è€…çš„è´£ä»»æ‹…å½“<sub class="subscript">æ³¨é‡Š</sub>ã€‚
                    </p>
                </section>

                <aside class="content-aside related-info">
                    <h3 class="aside-title related-title">ç›¸å…³ä¿¡æ¯</h3>
                    <dl class="definition-list info-list">
                        <dt class="term-title">æ´»åŠ¨ä¸»åŠæ–¹ï¼š</dt>
                        <dd class="term-description">è‡ªæ²»åŒºæ°‘æ”¿å…ã€è‡ªæ²»åŒºé«˜çº§æ³•é™¢</dd>
                        <dt class="term-title">ååŠå•ä½ï¼š</dt>
                        <dd class="term-description">è‡ªæ²»åŒºå¦‡è”ã€è‡ªæ²»åŒºæ•™è‚²å…</dd>
                        <dt class="term-title">æ´»åŠ¨æ—¶é—´ï¼š</dt>
                        <dd class="term-description">2025å¹´5æœˆ29æ—¥</dd>
                    </dl>
                </aside>

                <footer class="article-footer content-footer">
                    <div class="tag-list article-tags">
                        <span class="tag news-tag">å…¬ç›Šæ´»åŠ¨</span>
                        <span class="tag category-tag">å„¿ç«¥å…³çˆ±</span>
                        <span class="tag location-tag">å¹¿è¥¿</span>
                        <span class="tag event-tag">å…­ä¸€å„¿ç«¥èŠ‚</span>
                        <span class="tag type-tag">ç¤¾ä¼šæ–°é—»</span>
                    </div>
                </footer>
            </article>

        <aside class="sidebar news-sidebar">
            <section class="sidebar-section hot-news">
                <h2 class="sidebar-title section-header">å¹¿è¥¿è¦é—»</h2>
                <ul class="news-list hot-list">
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link">é™ˆåˆšåˆ°å—å®å¸‚è°ƒç ”ï¼Œå¼ºè°ƒè¦æ·±åŒ–äº§æ•™èåˆå‘å±•...</a>
                    </li>
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link">"æ¡‚å­—å·"å†œä¸šå“ç‰Œæ€»ä»·å€¼è¶…è¿‡<span class="number-value">5000äº¿å…ƒ</span></a>
                    </li>
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link">å¹¿è¥¿é¢å‘ä¸œç›Ÿçš„ç«‹ä½“ç»¼åˆé€šé“å»ºè®¾åŠ å¿«æˆå½¢</a>
                    </li>
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link">å¹¿è¥¿å¤šéƒ¨é—¨è”åŠ¨å¼€å±•"ç‰µæ‰‹'ç«¥'è¡Œ"å…¬ç›Šè¡ŒåŠ¨</a>
                    </li>
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link">å¹¿è¥¿<time class="year-time">2025å¹´</time>é«˜è€ƒæ‹›ç”Ÿæ–¹æ¡ˆå‡ºç‚‰</a>
                    </li>
                    <li class="news-item list-item">
                        <a href="#" class="news-link item-link"><time class="date-time">5æœˆ29æ—¥</time>å¹¿è¥¿è¿˜æœ‰å¤§èŒƒå›´å¼ºé™é›¨</a>
                    </li>
                </ul>
            </section>

            <section class="sidebar-section image-news">
                <h2 class="sidebar-title section-header">å›¾ç‰‡æ–°é—»</h2>
                <div class="image-placeholder news-image">
                    <p class="placeholder-text image-text">æ™ºèƒ½é—®ç­”</p>
                    <p class="description-text image-desc">å·¥ä¸šç”Ÿäº§åœºæ™¯å›¾ç‰‡å±•ç¤º</p>
                </div>
            </section>
        </aside>
    </div>

    <!-- ç¿»è¯‘åŠŸèƒ½é¢æ¿ -->
    <div class="translate-panel">
        <h3 class="translate-title">é¡µé¢ç¿»è¯‘</h3>
        <form id="translateForm">
            <div class="form-group">
                <label class="form-label" for="pathInput">è·¯å¾„ï¼š</label>
                <input type="text" class="form-input" id="pathInput" value="">
            </div>

            <div class="form-group">
                <label class="form-label" for="sourceLanguage">æºè¯­è¨€ï¼š</label>
                <select class="form-select" id="sourceLanguage">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">è‹±è¯­</option>
                    <option value="ja">æ—¥è¯­</option>
                    <option value="ko">éŸ©è¯­</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="targetLanguage">ç›®æ ‡è¯­è¨€ï¼š</label>
                <select class="form-select" id="targetLanguage">
                    <option value="en">è‹±è¯­</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="ja">æ—¥è¯­</option>
                    <option value="ko">éŸ©è¯­</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="untranslatableTags">ç¿»è¯‘ä¸åˆ°çš„æ ‡ç­¾ï¼š</label>
                <input type="text" class="form-input" id="untranslatableTags" placeholder="å¯é€‰">
            </div>

            <div class="form-group">
                <label class="form-label" for="noTranslateTags">ä¸éœ€è¦ç¿»è¯‘çš„æ ‡ç­¾ï¼š</label>
                <input type="text" class="form-input" id="noTranslateTags" placeholder="å¯é€‰">
            </div>

            <button type="submit" class="btn-translate">ğŸš€ å¼€å§‹ç¿»è¯‘</button>
        </form>

        <div id="statusMessage" class="status-message"></div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶è®¾ç½®å½“å‰URL
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('pathInput').value = window.location.href;
        });

        // ç¿»è¯‘åŠŸèƒ½
        document.getElementById('translateForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                path: document.getElementById('pathInput').value,
                html_body: document.body.outerHTML,
                source_language: document.getElementById('sourceLanguage').value,
                target_language: document.getElementById('targetLanguage').value,
                untranslatable_tags: document.getElementById('untranslatableTags').value || null,
                no_translate_tags: document.getElementById('noTranslateTags').value || null
            };

            console.log('å‘é€åˆ°åç«¯çš„æ•°æ®ï¼š', formData);

            const statusDiv = document.getElementById('statusMessage');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status-message status-loading';
            statusDiv.textContent = 'æ­£åœ¨å¤„ç†...';

            try {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 100)}...`);
                }

                const result = await response.json();

                statusDiv.className = 'status-message status-success';
                statusDiv.textContent = result.message;

                console.log('åç«¯è¿”å›çš„ç»“æœï¼š', result);

                // å¤„ç†ç¿»è¯‘ç»“æœ
                let translatedHtml, stats, processingMode;

                // æ£€æŸ¥æ˜¯å¤§å‹HTMLè¿˜æ˜¯æ ‡å‡†HTMLå¤„ç†ç»“æœ
                if (result.data.large_html_results) {
                    // å¤§å‹HTMLå¤„ç†ç»“æœ
                    translatedHtml = result.data.large_html_results.translated_html_body;
                    stats = result.data.large_html_results.processing_statistics;
                    processingMode = "å¤§å‹HTML";
                } else if (result.data.ultimate_replacement_results) {
                    // æ ‡å‡†HTMLå¤„ç†ç»“æœ
                    translatedHtml = result.data.ultimate_replacement_results.translated_html_body;
                    stats = result.data.ultimate_replacement_results.replacement_statistics;
                    processingMode = "æ ‡å‡†";
                }

                if (translatedHtml && stats) {
                    // æ„å»ºç¡®è®¤æ¶ˆæ¯
                    let confirmMessage = `ğŸ‰ ${processingMode}ç¿»è¯‘å®Œæˆï¼\n`;

                    if (stats.processing_time) {
                        confirmMessage += `å¤„ç†è€—æ—¶: ${stats.processing_time}ç§’\n`;
                    }
                    if (stats.chunks_processed) {
                        confirmMessage += `å¤„ç†å—æ•°: ${stats.chunks_processed}\n`;
                    }

                    confirmMessage += `æ›¿æ¢ç‡: ${stats.replacement_rate.toFixed(2)}%\n`;

                    if (stats.replaced_count !== undefined) {
                        confirmMessage += `å·²æ›¿æ¢ ${stats.replaced_count} ä¸ªä¸­æ–‡å­—ç¬¦\n`;
                    }
                    if (stats.remaining_chinese_count !== undefined) {
                        confirmMessage += `å‰©ä½™ ${stats.remaining_chinese_count} ä¸ªä¸­æ–‡å­—ç¬¦\n`;
                    }

                    confirmMessage += `\næ˜¯å¦è¦åº”ç”¨ç¿»è¯‘åˆ°å½“å‰é¡µé¢ï¼Ÿ`;

                    // è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦åº”ç”¨ç¿»è¯‘
                    const applyTranslation = confirm(confirmMessage);

                    if (applyTranslation) {
                        // æ›¿æ¢é¡µé¢bodyå†…å®¹
                        document.body.innerHTML = translatedHtml;

                        // æ›´æ–°çŠ¶æ€æ¶ˆæ¯
                        const newStatusDiv = document.getElementById('statusMessage');
                        if (newStatusDiv) {
                            newStatusDiv.textContent = `ğŸ‰ ${processingMode}ç¿»è¯‘å·²åº”ç”¨ï¼æ›¿æ¢ç‡: ${stats.replacement_rate.toFixed(2)}%`;
                        }

                        console.log(`ğŸ‰ ${processingMode}ç¿»è¯‘å·²åº”ç”¨ï¼`, stats);
                    }
                }

            } catch (error) {
                console.error('ç¿»è¯‘è¯·æ±‚å¤±è´¥ï¼š', error);
                statusDiv.className = 'status-message status-error';
                statusDiv.textContent = 'è¯·æ±‚å¤±è´¥ï¼š' + error.message;
            }
        });


    </script>

</body>
</html>
