<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多标签页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
        }

        .content-section {
            margin-bottom: 40px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }

        .card h3 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: monospace;
        }

        .api-list {
            list-style: none;
        }

        .api-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .api-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }

        .method-get {
            background: #d4edda;
            color: #155724;
        }

        .method-post {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-container {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-line {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-time {
            color: #68d391;
        }

        .log-level {
            font-weight: bold;
        }

        .log-info { color: #63b3ed; }
        .log-warning { color: #f6e05e; }
        .log-error { color: #fc8181; }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            opacity: 0.8;
        }

        .text-section {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .text-section h4 {
            color: #007bff;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .text-section p {
            line-height: 1.6;
            margin-bottom: 8px;
            color: #495057;
        }

        /* 新增的HTML标签样式 */
        h1, h2, h3, h4, h5, h6 {
            margin: 20px 0 10px 0;
            color: #2c3e50;
        }

        h1 { font-size: 2.5rem; color: #e74c3c; }
        h2 { font-size: 2rem; color: #3498db; }
        h3 { font-size: 1.75rem; color: #2ecc71; }
        h4 { font-size: 1.5rem; color: #f39c12; }
        h5 { font-size: 1.25rem; color: #9b59b6; }
        h6 { font-size: 1rem; color: #34495e; }

        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        blockquote {
            border-left: 4px solid #007bff;
            margin: 20px 0;
            padding: 10px 20px;
            background: #f8f9fa;
            font-style: italic;
        }

        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        mark {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        abbr {
            border-bottom: 1px dotted #6c757d;
            cursor: help;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 5px 0;
            line-height: 1.6;
        }

        dl {
            margin: 15px 0;
        }

        dt {
            font-weight: bold;
            color: #495057;
            margin-top: 10px;
        }

        dd {
            margin: 5px 0 10px 20px;
            color: #6c757d;
        }

        article {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        section {
            margin: 20px 0;
        }

        aside {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }

        details {
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            margin: 15px 0;
        }

        summary {
            cursor: pointer;
            font-weight: bold;
            color: #007bff;
            padding: 5px;
        }

        summary:hover {
            background: #f8f9fa;
        }

        figure {
            border: 2px dashed #dee2e6;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border-radius: 5px;
        }

        figcaption {
            font-style: italic;
            color: #6c757d;
            margin-top: 10px;
        }

        address {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-style: normal;
            line-height: 1.6;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* 翻译功能样式 */
        .translation-controls {
            margin-top: 20px;
            text-align: center;
        }

        .btn-translate {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-translate:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-translate:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-restore {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .btn-restore:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .translation-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
            min-height: 20px;
        }

        .status-loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .translated-content {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* 查看源码按钮样式 */
        .source-code-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .btn-source {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(111, 66, 193, 0.3);
        }

        .btn-source:hover {
            background: #5a32a3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.4);
        }

        /* 源码查看器样式 */
        .source-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            overflow: auto;
        }

        .source-viewer-content {
            background: #1e1e1e;
            color: #d4d4d4;
            margin: 20px;
            border-radius: 10px;
            position: relative;
            max-height: calc(100vh - 40px);
            overflow: auto;
        }

        .source-viewer-header {
            background: #2d2d30;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .source-viewer-title {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .source-viewer-close {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .source-viewer-close:hover {
            background: #c0392b;
        }

        .source-viewer-body {
            padding: 0;
        }

        .source-code {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 20px;
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            border-radius: 0 0 10px 10px;
        }

        .source-code .tag {
            color: #569cd6;
        }

        .source-code .attr-name {
            color: #9cdcfe;
        }

        .source-code .attr-value {
            color: #ce9178;
        }

        .source-code .comment {
            color: #6a9955;
            font-style: italic;
        }

        .source-code .string {
            color: #ce9178;
        }

        .source-code .keyword {
            color: #c586c0;
        }

        .copy-btn {
            position: absolute;
            top: 70px;
            right: 30px;
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s ease;
        }

        .copy-btn:hover {
            background: #005a9e;
        }

        /* 确认弹窗样式 */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .confirm-modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .confirm-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .confirm-modal-message {
            font-size: 1rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .confirm-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .confirm-btn-yes {
            background: #28a745;
            color: white;
        }

        .confirm-btn-yes:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .confirm-btn-no {
            background: #6c757d;
            color: white;
        }

        .confirm-btn-no:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- 查看源码按钮 -->
            <div class="source-code-btn">
                <button id="viewSourceBtn" class="btn btn-source" onclick="viewSourceCode()">
                    📄 查看源码
                </button>
            </div>

            <h1>📚 多标签内容展示</h1>
            <p>关于分组与异步的代码可查看右上角的查看源码</p>

            <!-- 翻译控制按钮 -->
            <div class="translation-controls">
                <button id="translateBtn" class="btn btn-translate" onclick="translateAllContent()">
                    🔄 批量翻译（分组并发）
                </button>
                <button id="translateAsyncBtn" class="btn btn-translate" onclick="translateAllContentAsync()" style="margin-left: 10px;">
                    ⚡ 异步翻译（实时显示）
                </button>
                <button id="restoreBtn" class="btn btn-restore" onclick="restoreOriginalContent()" style="display: none;">
                    🔙 恢复原始中文内容
                </button>
                <div id="translationStatus" class="translation-status"></div>
            </div>
        </div>

        <div class="content-container">
                <!-- 文本格式标签展示 -->
                <div class="content-section">
                    <h1>这是一级标题 - 展示网页的主要主题</h1>
                    <h2>这是二级标题 - 用于章节划分</h2>
                    <h3>这是三级标题 - 用于小节标题</h3>
                    <h4>这是四级标题 - 用于子小节</h4>
                    <h5>这是五级标题 - 用于更细的分类</h5>
                    <h6>这是六级标题 - 最小的标题级别</h6>

                    <p>这是一个段落标签，包含了普通的文本内容。段落是HTML中最常用的文本容器。</p>
                    <p>这是另一个段落，展示了段落之间的间距效果。</p>

                    <br>这里使用了换行标签
                    <br>可以看到文本换到了新的一行

                    <hr>

                    <pre>这是预格式化文本标签
    它会保留空格和换行
        甚至是缩进也会被保留
            非常适合显示代码</pre>

                    <blockquote>
                        这是一个引用块，通常用来引用他人的话语或者重要的文本内容。
                        引用块会有特殊的样式来区别于普通文本。
                    </blockquote>

                    <p>这里有一些<code>内联代码</code>的示例，用于在文本中插入代码片段。</p>

                    <p>文本格式化标签：<em>这是强调文本</em>，<strong>这是重要文本</strong>，<i>这是斜体文本</i>，<b>这是粗体文本</b>。</p>

                    <p>更多格式：<u>这是下划线文本</u>，<s>这是删除线文本</s>，这是<sub>下标文本</sub>，这是<sup>上标文本</sup>。</p>

                    <p><small>这是小号文本，通常用于版权信息或者注释</small></p>

                    <p><abbr title="HyperText Markup Language">HTML</abbr>是网页标记语言的缩写。</p>

                    <p>正如<cite>《HTML权威指南》</cite>一书中所说的那样。</p>

                    <p>孔子说过：<q>学而时习之，不亦说乎</q>。</p>

                    <p>这篇文章发布于<time datetime="2024-01-15">2024年1月15日</time>。</p>

                    <p>这段文本中有<mark>高亮标记的重要内容</mark>需要注意。</p>
                </div>

                <!-- 列表标签展示 -->
                <div class="content-section">
                    <h2>列表标签展示区域</h2>

                    <h3>无序列表示例</h3>
                    <ul>
                        <li>这是无序列表的第一项</li>
                        <li>这是无序列表的第二项</li>
                        <li>这是无序列表的第三项
                            <ul>
                                <li>嵌套列表项目一</li>
                                <li>嵌套列表项目二</li>
                            </ul>
                        </li>
                        <li>这是无序列表的第四项</li>
                    </ul>

                    <h3>有序列表示例</h3>
                    <ol>
                        <li>这是有序列表的第一步</li>
                        <li>这是有序列表的第二步</li>
                        <li>这是有序列表的第三步
                            <ol>
                                <li>子步骤A</li>
                                <li>子步骤B</li>
                            </ol>
                        </li>
                        <li>这是有序列表的第四步</li>
                    </ol>

                    <h3>定义列表示例</h3>
                    <dl>
                        <dt>HTML</dt>
                        <dd>超文本标记语言，用于创建网页的标准标记语言</dd>
                        <dd>由蒂姆·伯纳斯-李在1990年发明</dd>

                        <dt>CSS</dt>
                        <dd>层叠样式表，用于描述HTML文档的样式</dd>
                        <dd>可以控制网页的布局、颜色、字体等视觉效果</dd>

                        <dt>JavaScript</dt>
                        <dd>一种高级的、解释型的编程语言</dd>
                        <dd>主要用于网页的交互功能开发</dd>
                    </dl>
                </div>

                <!-- 更多HTML标签展示 -->
                <div class="content-section">
                    <h2>综合标签展示区域</h2>

                    <article>
                        <header>
                            <h3>这是一个文章标题</h3>
                            <p>发布于 <time datetime="2024-01-15">2024年1月15日</time> 作者：<cite>张三</cite></p>
                        </header>

                        <section>
                            <h4>第一章节</h4>
                            <p>这是文章的第一个段落，包含了<strong>重要的信息</strong>和<em>强调的内容</em>。</p>
                            <p>这里有一个<a href="#example">链接示例</a>，还有一些<code>代码片段</code>。</p>
                        </section>

                        <section>
                            <h4>第二章节</h4>
                            <p>这个段落展示了更多的文本格式：</p>
                            <ul>
                                <li><b>粗体文本</b>和<i>斜体文本</i></li>
                                <li><u>下划线文本</u>和<s>删除线文本</s></li>
                                <li>数学公式：H<sub>2</sub>O 和 E=mc<sup>2</sup></li>
                                <li><small>小号文本用于注释</small></li>
                            </ul>
                        </section>

                        <aside>
                            <h5>侧边栏信息</h5>
                            <p>这是一个侧边栏，通常包含相关但不是主要的信息。</p>
                            <blockquote>
                                <p>这是一个引用："<q>学而时习之，不亦说乎？</q>"</p>
                                <footer>—— <cite>孔子《论语》</cite></footer>
                            </blockquote>
                        </aside>

                        <footer>
                            <p><small>文章结束，版权所有 &copy; 2025</small></p>
                        </footer>
                    </article>

                    <hr>

                    <details>
                        <summary>点击展开更多内容</summary>
                        <p>这是一个可折叠的内容区域，用户可以点击标题来展开或收起内容。</p>
                        <p>这里可以放置详细的说明信息或者额外的内容。</p>
                    </details>

                    <hr>

                    <figure>
                        <figcaption>图表说明：这里本来应该有一个图片</figcaption>
                        <p>[图片占位符 - 展示figure和figcaption标签的使用]</p>
                    </figure>

                    <address>
                        联系地址：<br>
                        南宁市青秀区<br>
                        邮编：999999<br>
                        电话：010-12345678
                    </address>
                </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 多文字内容展示平台 | 丰富的文字内容分类展示</p>
        </div>
    </div>

    <!-- 确认弹窗 -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-title">🔒 查看源码之前-请听听我的故事🦂</div>
            <div class="confirm-modal-message">
                我本后端工程师，奈何天不测风云，<br>
                一觉醒来竟重生，开局竟是——小学生！<br>
                代码记忆全保留，手速脑速却归零，<br>
                面对九九乘法表，血压直接往上冲。<br>
                “这题太简单，我要写 Spring！”<br>
                老师怒拍讲台：“你作业呢？交上来！”<br>
                前生 CRUD 称王者，今世拼音不过关，<br>
                Redis 缓存全精通，奈何听写全玩完。<br>
                产品经理变同桌，天天画饼不消停，<br>
                “这次需求很简单，就改五个小功能！”<br>
                测试妹子是班长，眼神犀利如刀锋，<br>
                “你代码又有 Bug，放学别走再改通！”<br>
                重活一世心好累，只想躺平做咸鱼，<br>
                谁知小学奥数题，竟比高并发还卷！<br>
                罢罢罢，这一世，定要活出新高度——<br>
                先考年级第一名，再写个操作系统！<br>
                <strong>V我50继续收听我的故事❤</strong>
            </div>
            <div class="confirm-modal-buttons">
                <button class="confirm-btn confirm-btn-no" onclick="cancelViewSource()">
                    ❌ 我真的没钱纳
                </button>
                <button class="confirm-btn confirm-btn-yes" onclick="confirmViewSource()">
                    ✅ 可以
                </button>
            </div>
        </div>
    </div>

    <!-- 源码查看器 -->
    <div id="sourceViewer" class="source-viewer">
        <div class="source-viewer-content">
            <div class="source-viewer-header">
                <div class="source-viewer-title">📄 页面源码</div>
                <button class="source-viewer-close" onclick="closeSourceViewer()">✕ 关闭</button>
            </div>
            <button class="copy-btn" onclick="copySourceCode()">📋 复制代码</button>
            <div class="source-viewer-body">
                <pre id="sourceCode" class="source-code"></pre>
            </div>
        </div>
    </div>

    <script>
        // 存储原始内容
        let originalContent = {};
        let isTranslated = false;

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('多文字内容展示页面加载完成');
            // 保存原始内容
            saveOriginalContent();
        });

        // 保存原始内容
        function saveOriginalContent() {
            const textElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, li, dt, dd, blockquote, pre, code, em, strong, i, b, u, s, small, abbr, cite, q, time, mark, figcaption, address');

            textElements.forEach((element, index) => {
                originalContent[index] = {
                    element: element,
                    originalText: element.innerHTML,
                    tagName: element.tagName.toLowerCase()
                };
            });

            console.log(`已保存 ${Object.keys(originalContent).length} 个元素的原始内容`);
        }

        // 翻译所有内容（批量模式）
        async function translateAllContent() {
            if (isTranslated) {
                showStatus('内容已经翻译过了', 'error');
                return;
            }

            const translateBtn = document.getElementById('translateBtn');
            const restoreBtn = document.getElementById('restoreBtn');

            // 禁用按钮并显示加载状态
            translateBtn.disabled = true;
            translateBtn.innerHTML = '🔄 翻译中...';
            showStatus('正在收集中文内容并批量翻译...', 'loading');

            try {
                // 收集所有需要翻译的文本
                const textsToTranslate = [];
                for (let index in originalContent) {
                    const item = originalContent[index];
                    const textContent = item.element.textContent.trim();

                    // 只翻译包含中文的内容
                    if (containsChinese(textContent)) {
                        textsToTranslate.push({
                            index: index,
                            text: textContent,
                            element: item.element
                        });
                    }
                }

                console.log(`找到 ${textsToTranslate.length} 个包含中文的元素需要翻译`);

                if (textsToTranslate.length === 0) {
                    showStatus('没有找到需要翻译的中文内容', 'error');
                    translateBtn.disabled = false;
                    translateBtn.innerHTML = '🔄 翻译所有中文内容为英文';
                    return;
                }

                // 准备批量翻译的文本
                const batchTexts = textsToTranslate.map(item => item.text);

                showStatus(`正在批量翻译 ${batchTexts.length} 个文本片段...`, 'loading');

                // 调用批量翻译接口
                const translatedResults = await batchTranslateTexts(batchTexts);

                console.log('批量翻译最终结果:', translatedResults);
                console.log('预期结果数量:', batchTexts.length, '实际结果数量:', translatedResults ? translatedResults.length : 0);

                if (translatedResults && translatedResults.length > 0) {
                    // 应用翻译结果（允许部分成功）
                    let successCount = 0;
                    let appliedCount = 0;

                    for (let i = 0; i < textsToTranslate.length && i < translatedResults.length; i++) {
                        const item = textsToTranslate[i];
                        const translatedText = translatedResults[i];

                        console.log(`应用翻译结果 ${i + 1}:`, translatedText);

                        if (translatedText && translatedText.trim()) {
                            item.element.innerHTML = translatedText;
                            item.element.classList.add('translated-content');
                            successCount++;
                        }
                        appliedCount++;
                    }

                    // 处理剩余未翻译的元素（如果有的话）
                    if (translatedResults.length < textsToTranslate.length) {
                        console.warn(`有 ${textsToTranslate.length - translatedResults.length} 个元素未能获得翻译结果`);
                    }

                    if (successCount > 0) {
                        showStatus(`批量翻译完成！成功翻译 ${successCount}/${textsToTranslate.length} 个元素`, 'success');
                        isTranslated = true;
                        restoreBtn.style.display = 'inline-block';
                    } else {
                        showStatus('翻译完成但没有有效的翻译结果', 'error');
                    }
                } else {
                    console.error('批量翻译结果验证失败');
                    console.error('translatedResults:', translatedResults);
                    console.error('batchTexts.length:', batchTexts.length);
                    showStatus('批量翻译失败，没有获得有效的翻译结果', 'error');
                }

            } catch (error) {
                console.error('批量翻译过程中发生错误:', error);
                showStatus('翻译失败: ' + error.message, 'error');
            } finally {
                // 恢复按钮状态
                translateBtn.disabled = false;
                translateBtn.innerHTML = '🔄 翻译所有中文内容为英文';
            }
        }

        // 完全异步翻译（实时显示结果）
        async function translateAllContentAsync() {
            if (isTranslated) {
                showStatus('内容已经翻译过了', 'error');
                return;
            }

            const translateBtn = document.getElementById('translateBtn');
            const translateAsyncBtn = document.getElementById('translateAsyncBtn');
            const restoreBtn = document.getElementById('restoreBtn');

            // 禁用按钮
            translateBtn.disabled = true;
            translateAsyncBtn.disabled = true;
            translateAsyncBtn.innerHTML = '⚡ 翻译中...';
            showStatus('启动异步翻译，结果将实时显示...', 'loading');

            try {
                // 收集所有需要翻译的文本
                const textsToTranslate = [];
                for (let index in originalContent) {
                    const item = originalContent[index];
                    const textContent = item.element.textContent.trim();

                    if (containsChinese(textContent)) {
                        textsToTranslate.push({
                            index: index,
                            text: textContent,
                            element: item.element
                        });
                    }
                }

                if (textsToTranslate.length === 0) {
                    showStatus('没有找到需要翻译的中文内容', 'error');
                    return;
                }

                console.log(`启动异步翻译 ${textsToTranslate.length} 个元素`);

                let completedCount = 0;
                let successCount = 0;

                // 创建所有异步翻译任务
                const translatePromises = textsToTranslate.map(async (item, index) => {
                    try {
                        // 为每个元素添加翻译中的视觉提示
                        item.element.style.opacity = '0.6';
                        item.element.style.backgroundColor = '#fff3cd';

                        const translatedText = await translateSingleText(item.text);

                        if (translatedText) {
                            // 立即更新UI
                            item.element.innerHTML = translatedText;
                            item.element.classList.add('translated-content');
                            item.element.style.opacity = '1';
                            item.element.style.backgroundColor = '';
                            successCount++;
                        } else {
                            // 翻译失败，恢复样式
                            item.element.style.opacity = '1';
                            item.element.style.backgroundColor = '';
                        }

                        completedCount++;

                        // 更新进度
                        showStatus(`异步翻译进度: ${completedCount}/${textsToTranslate.length} (成功: ${successCount})`, 'loading');

                        return { success: !!translatedText, index };
                    } catch (error) {
                        console.error(`异步翻译第 ${index + 1} 个元素失败:`, error);
                        item.element.style.opacity = '1';
                        item.element.style.backgroundColor = '';
                        completedCount++;
                        return { success: false, index };
                    }
                });

                // 等待所有翻译完成
                await Promise.all(translatePromises);

                // 显示最终结果
                showStatus(`异步翻译完成！成功: ${successCount}/${textsToTranslate.length}`, 'success');
                isTranslated = true;
                restoreBtn.style.display = 'inline-block';

            } catch (error) {
                console.error('异步翻译过程中发生错误:', error);
                showStatus('异步翻译失败: ' + error.message, 'error');
            } finally {
                // 恢复按钮状态
                translateBtn.disabled = false;
                translateAsyncBtn.disabled = false;
                translateAsyncBtn.innerHTML = '⚡ 异步翻译（实时显示）';
            }
        }

        // 翻译单个文本（用于异步模式）
        async function translateSingleText(text) {
            try {
                const response = await fetch('/api/translate_to_english', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.trans_result && data.trans_result.length > 0) {
                    return data.trans_result[0].dst;
                } else {
                    return null;
                }
            } catch (error) {
                console.error('单个翻译请求失败:', error);
                return null;
            }
        }

        // 恢复原始内容
        function restoreOriginalContent() {
            for (let index in originalContent) {
                const item = originalContent[index];
                item.element.innerHTML = item.originalText;
                item.element.classList.remove('translated-content');
                item.element.style.opacity = '1';
                item.element.style.backgroundColor = '';
            }

            isTranslated = false;
            document.getElementById('restoreBtn').style.display = 'none';
            showStatus('已恢复原始中文内容', 'success');
        }

        // 异步批量翻译文本（分组并发）
        async function batchTranslateTexts(texts) {
            const BATCH_SIZE = 10; // 每组处理10个文本
            const MAX_CONCURRENT = 3; // 最大并发请求数

            try {
                // 将文本分组
                const textGroups = [];
                for (let i = 0; i < texts.length; i += BATCH_SIZE) {
                    textGroups.push(texts.slice(i, i + BATCH_SIZE));
                }

                console.log(`将 ${texts.length} 个文本分为 ${textGroups.length} 组进行并发翻译`);

                // 并发处理分组
                const results = [];
                for (let i = 0; i < textGroups.length; i += MAX_CONCURRENT) {
                    const currentBatch = textGroups.slice(i, i + MAX_CONCURRENT);

                    // 创建并发请求
                    const promises = currentBatch.map(group => translateGroup(group));

                    // 等待当前批次完成
                    const batchResults = await Promise.all(promises);

                    console.log(`批次 ${Math.floor(i/MAX_CONCURRENT) + 1} 完成，结果:`, batchResults);

                    // 合并结果
                    batchResults.forEach((groupResult, groupIndex) => {
                        console.log(`合并分组 ${groupIndex + 1} 结果:`, groupResult);
                        if (groupResult && Array.isArray(groupResult)) {
                            // 过滤掉null值，只保留有效的翻译结果
                            const validResults = groupResult.filter(result => result !== null && result !== undefined && result.trim() !== '');
                            results.push(...groupResult); // 保持原始数组结构，包括null值
                        } else {
                            console.error(`分组 ${groupIndex + 1} 结果格式错误:`, groupResult);
                            // 添加空结果占位，保持索引对应关系
                            const groupSize = currentBatch[groupIndex] ? currentBatch[groupIndex].length : 0;
                            results.push(...new Array(groupSize).fill(null));
                        }
                    });

                    // 更新进度
                    const progress = Math.min(results.length, texts.length);
                    showStatus(`翻译进度: ${progress}/${texts.length}`, 'loading');
                }

                return results;

            } catch (error) {
                console.error('异步批量翻译失败:', error);
                throw error;
            }
        }

        // 翻译单个分组
        async function translateGroup(texts) {
            try {
                // 将文本转换为批量翻译接口需要的格式
                const items = texts.map((text, index) => ({
                    text: text,
                    id: `item_${index}`
                }));

                const response = await fetch('/api/batch/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        items: items,
                        from_lang: 'zh',
                        to_lang: 'en'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                // 添加调试信息
                console.log('批量翻译响应数据:', data);

                if (data.results && Array.isArray(data.results)) {
                    return data.results.map(result => {
                        console.log('处理翻译结果:', result);
                        if (result.trans_result && result.trans_result.length > 0) {
                            return result.trans_result[0].dst;
                        }
                        return null;
                    });
                } else {
                    console.error('响应数据格式不正确:', data);
                    throw new Error('分组翻译结果格式错误: ' + JSON.stringify(data));
                }
            } catch (error) {
                console.error('分组翻译请求失败:', error);
                // 返回空结果而不是抛出错误，避免影响其他分组
                return new Array(texts.length).fill(null);
            }
        }

        // 检查文本是否包含中文
        function containsChinese(text) {
            return /[\u4e00-\u9fa5]/.test(text);
        }

        // 显示状态信息
        function showStatus(message, type) {
            const statusDiv = document.getElementById('translationStatus');
            statusDiv.textContent = message;
            statusDiv.className = `translation-status status-${type}`;

            // 3秒后清除成功状态
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.textContent = '';
                    statusDiv.className = 'translation-status';
                }, 3000);
            }
        }

        // 查看源码功能（显示确认弹窗）
        function viewSourceCode() {
            const confirmModal = document.getElementById('confirmModal');
            confirmModal.style.display = 'flex';

            // 防止页面滚动
            document.body.style.overflow = 'hidden';
        }

        // 确认查看源码
        function confirmViewSource() {
            const confirmModal = document.getElementById('confirmModal');
            const sourceViewer = document.getElementById('sourceViewer');
            const sourceCode = document.getElementById('sourceCode');

            // 隐藏确认弹窗
            confirmModal.style.display = 'none';

            try {
                // 获取完整的HTML源码
                const htmlSource = document.documentElement.outerHTML;

                // 格式化HTML源码
                const formattedHtml = formatHtml(htmlSource);

                // 显示源码
                sourceCode.textContent = formattedHtml;
                sourceViewer.style.display = 'block';

            } catch (error) {
                console.error('格式化HTML时出错:', error);

                // 如果格式化失败，显示原始HTML
                const htmlSource = document.documentElement.outerHTML;
                sourceCode.textContent = htmlSource;
                sourceViewer.style.display = 'block';
            }
        }

        // 取消查看源码
        function cancelViewSource() {
            const confirmModal = document.getElementById('confirmModal');
            confirmModal.style.display = 'none';

            // 恢复页面滚动
            document.body.style.overflow = 'auto';
        }

        // 关闭源码查看器
        function closeSourceViewer() {
            const sourceViewer = document.getElementById('sourceViewer');
            sourceViewer.style.display = 'none';

            // 恢复页面滚动
            document.body.style.overflow = 'auto';
        }

        // 复制源码到剪贴板
        async function copySourceCode() {
            const sourceCode = document.getElementById('sourceCode');
            const text = sourceCode.textContent;

            try {
                await navigator.clipboard.writeText(text);

                // 显示复制成功提示
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '✅ 已复制';
                copyBtn.style.background = '#28a745';

                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '#007acc';
                }, 2000);

            } catch (err) {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择文本复制');
            }
        }

        // 简单的HTML格式化函数
        function formatHtml(html) {
            let formatted = '';
            let indent = 0;
            const tab = '    '; // 4个空格作为缩进

            // 移除多余的空白字符并分行
            html = html.replace(/>\s*</g, '>\n<');
            const lines = html.split('\n');

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // 检查是否是结束标签
                if (line.match(/^<\/\w/)) {
                    // 结束标签，先减少缩进再输出
                    indent = Math.max(0, indent - 1);
                    formatted += tab.repeat(indent) + line + '\n';
                } else if (line.match(/^<\w[^>]*\/>$/)) {
                    // 自闭合标签，不改变缩进
                    formatted += tab.repeat(indent) + line + '\n';
                } else if (line.match(/^<\w[^>]*>$/)) {
                    // 开始标签，先输出再增加缩进
                    formatted += tab.repeat(indent) + line + '\n';
                    indent++;
                } else if (line.match(/^<!/)) {
                    // DOCTYPE、注释等，不改变缩进
                    formatted += tab.repeat(indent) + line + '\n';
                } else if (line.match(/^</)) {
                    // 其他标签
                    formatted += tab.repeat(indent) + line + '\n';
                } else {
                    // 文本内容
                    formatted += tab.repeat(indent) + line + '\n';
                }
            }

            return formatted;
        }

        // 键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl+U 或 Cmd+U 查看源码
            if ((e.ctrlKey || e.metaKey) && e.key === 'u') {
                e.preventDefault();
                viewSourceCode();
            }

            // ESC 关闭弹窗和源码查看器
            if (e.key === 'Escape') {
                const confirmModal = document.getElementById('confirmModal');
                const sourceViewer = document.getElementById('sourceViewer');

                if (confirmModal.style.display === 'flex') {
                    cancelViewSource();
                } else if (sourceViewer.style.display === 'block') {
                    closeSourceViewer();
                }
            }

            // Enter 确认查看源码（当确认弹窗显示时）
            if (e.key === 'Enter') {
                const confirmModal = document.getElementById('confirmModal');
                if (confirmModal.style.display === 'flex') {
                    confirmViewSource();
                }
            }
        });

        // 点击背景关闭确认弹窗
        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelViewSource();
            }
        });

        // 点击背景关闭源码查看器
        document.getElementById('sourceViewer').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSourceViewer();
            }
        });

    </script>
</body>
</html>
