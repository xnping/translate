<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Translator.js插件文档</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <style>
    body { background: #f7f9fa; font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif; margin: 0; color: #333; line-height: 1.6; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 32px 32px 48px 32px; }
    h1 { text-align: center; color: #2a4d8f; margin-bottom: 20px; font-size: 32px; }
    h2 { color: #2a4d8f; margin-top: 30px; margin-bottom: 16px; font-size: 24px; padding-bottom: 6px; border-bottom: 1px solid #eee; }
    h3 { color: #2a4d8f; margin-top: 25px; margin-bottom: 15px; font-size: 20px; }
    .nav { text-align: right; margin-bottom: 24px; }
    .nav a { color: #4b8bf4; text-decoration: none; margin-left: 18px; font-weight: bold; transition: color 0.2s; }
    .nav a:hover { text-decoration: underline; color: #1a73e8; }
    pre { background: #f6f8fa; border-radius: 6px; padding: 15px; overflow-x: auto; border: 1px solid #e8e8e8; margin: 18px 0; }
    code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 14px; }
    p code, li code { background: #f0f2f5; padding: 2px 5px; border-radius: 3px; color: #d14; font-size: 0.95em; }
    table { border-collapse: collapse; width: 100%; margin: 22px 0; }
    th, td { border: 1px solid #eaeaea; padding: 10px 15px; text-align: left; }
    th { background: #f3f6fa; font-weight: 600; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    hr { border: none; border-top: 1px solid #eee; margin: 32px 0; }
    .plugin-downloads { background: #f3f6fa; border-radius: 8px; box-shadow: 0 1px 6px rgba(44,90,255,0.04); padding: 28px 24px 18px 24px; margin-bottom: 32px; }
    .plugin-list { display: flex; flex-wrap: wrap; gap: 18px; justify-content: center; }
    .plugin-card { background: #fff; border-radius: 7px; box-shadow: 0 2px 8px rgba(44,90,255,0.07); padding: 18px 28px; display: flex; align-items: center; min-width: 260px; max-width: 320px; flex: 1 1 260px; }
    .plugin-info { flex: 1; }
    .plugin-title { font-weight: bold; color: #2a4d8f; font-size: 1.08em; display: block; margin-bottom: 4px; }
    .plugin-desc { color: #666; font-size: 0.97em; }
    .download-btn { background: linear-gradient(90deg,#4b8bf4,#2a4d8f); color: #fff; padding: 7px 22px; border-radius: 4px; text-decoration: none; font-weight: bold; font-size: 1em; box-shadow: 0 1px 4px rgba(44,90,255,0.08); transition: background 0.2s; margin-left: 18px; }
    .download-btn:hover { background: linear-gradient(90deg,#2a4d8f,#4b8bf4); }
    .hidden-en {
      display: none;
    }
    .language-js {
      background: #f6f8fa;
      border-radius: 6px;
    }
    .language-json {
      background: #f6f8fa;
      border-radius: 6px;
    }
    /* 悬浮语言切换器样式 */
    .floating-language-switcher {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 1000;
    }
    .language-toggle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #4b8bf4;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: transform 0.3s;
    }
    .language-toggle:hover {
      transform: scale(1.05);
    }
    .language-options {
      position: absolute;
      bottom: 60px;
      right: 0;
      background: white;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.15);
      display: none;
    }
    .language-btn {
      background: #f0f4f9; 
      border: 1px solid #d0d7de; 
      border-radius: 4px; 
      padding: 8px 14px; 
      margin-left: 8px; 
      cursor: pointer; 
      font-size: 14px;
      transition: all 0.2s;
    }
    .language-btn:hover { 
      background: #e0e7ef; 
    }
    .language-btn.active { 
      background: #4b8bf4; 
      color: white; 
      border-color: #4b8bf4; 
    }
    .endpoint {
      display: inline-block;
      background: #e8f0fe;
      padding: 6px 12px;
      border-radius: 4px;
      font-family: monospace;
      font-weight: bold;
      margin: 8px 0;
      border: 1px solid #d0e0fc;
    }
    footer {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    .visible-en {
      display: none;
    }
    /* 翻译进度指示器 */
    .translation-progress {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }
    .translation-progress.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav">
      <a href="/static/index.html" data-translate="back-home">返回首页</a>
    </div>
    
    <!-- 翻译进度指示器 -->
    <div class="translation-progress">
      正在翻译...
    </div>
    
    <div class="plugin-downloads">
      <h2 style="color:#2a4d8f; margin-bottom:18px; text-align:center;" data-translate="plugin-download">插件下载</h2>
      <div class="plugin-list">
        <div class="plugin-card">
          <div class="plugin-info">
            <span class="plugin-title" data-translate="native-js-plugin">原生js插件</span>
            <span class="plugin-desc" data-translate="for-frontend-projects">适用于前端工程化项目</span>
          </div>
          <a href="/static/js/translator.js" download class="download-btn" data-translate="download-btn">下载</a>
        </div>
      </div>
    </div>
    
    <div id="plugin-doc">
      <!-- 中文文档内容 -->
      <div class="plugin-content zh">
        <h1>Translator.js API 文档</h1>
    
        <p><code>Translator.js</code> 是一个适用于东盟多语言场景的翻译 API 前端插件，基于异步翻译服务，支持通用翻译、东盟十国快捷翻译、批量翻译、缓存控制等功能。</p>
    
        <h2>初始化</h2>
    
        <pre><code class="language-js">// 初始化翻译器
const translator = new BaiduTranslator('/api'); // 默认API路径为 '/api'</code></pre>
    
        <h2>核心方法</h2>
    
        <h3>1. 通用翻译</h3>
    
        <pre><code class="language-js">translator.translate(text, fromLang = 'auto', toLang = 'zh', useCache = true, options = {})
  .then(result => console.log(result.translatedText));</code></pre>
    
        <p><strong>参数说明：</strong></p>
        <ul>
          <li><code>text</code> (string, 必填)：要翻译的文本</li>
          <li><code>fromLang</code> (string, 可选)：源语言代码，默认 'auto'</li>
          <li><code>toLang</code> (string, 可选)：目标语言代码，默认 'zh'</li>
          <li><code>useCache</code> (boolean, 可选)：是否使用缓存，默认 true</li>
          <li><code>options</code> (object, 可选)：
            <ul>
              <li><code>fontSize</code> (string)：建议字体大小（如 '24px'）</li>
            </ul>
          </li>
        </ul>
    
        <p><strong>返回值：</strong></p>
        <pre><code class="language-json">{
  "from": "zh",
  "to": "en",
  "trans_result": [{ "src": "你好", "dst": "Hello" }],
  "font_size": "24px",
  "translatedText": "Hello" // 便捷访问属性
}</code></pre>
    
        <h3>2. 批量翻译</h3>
    
        <pre><code class="language-js">translator.batchTranslate(items, fromLang = 'auto', toLang = 'zh', options = {})
  .then(results => console.log(results));</code></pre>
    
        <p><strong>参数说明：</strong></p>
        <ul>
          <li><code>items</code> (Array, 必填)：要翻译的文本数组，可以是：
            <ul>
              <li>字符串数组: <code>['文本1', '文本2']</code></li>
              <li>对象数组: <code>[{text: '文本1', id: 'id1'}, {text: '文本2', id: 'id2'}]</code></li>
            </ul>
          </li>
          <li><code>fromLang</code> (string, 可选)：源语言代码，默认 'auto'</li>
          <li><code>toLang</code> (string, 可选)：目标语言代码，默认 'zh'</li>
          <li><code>options</code> (object, 可选)：
            <ul>
              <li><code>fontSize</code> (string)：建议字体大小</li>
              <li><code>maxConcurrent</code> (number)：最大并发请求数</li>
            </ul>
          </li>
        </ul>
    
        <p><strong>返回值：</strong></p>
        <pre><code class="language-json">{
  "results": [
    {
      "from": "zh",
      "to": "en",
      "trans_result": [{ "src": "你好", "dst": "Hello" }],
      "id": "id1",
      "index": 0
    },
    ...
  ],
  "total": 2,
  "success": 2,
  "failed": 0
}</code></pre>
    
        <h3>3. 获取支持的语言列表</h3>
    
        <pre><code class="language-js">translator.getLanguages()
  .then(languages => console.log(languages));</code></pre>
    
        <p><strong>返回值：</strong></p>
        <pre><code class="language-json">{
  "auto": "自动检测",
  "zh": "中文",
  "en": "英语",
  "th": "泰语",
  ...
}</code></pre>
    
        <h3>4. 健康检查</h3>
    
        <pre><code class="language-js">translator.healthCheck()
  .then(status => console.log(status));</code></pre>
    
        <p><strong>返回值：</strong></p>
        <pre><code class="language-json">{
  "status": "healthy",
  "version": "2.0.0",
  "cache": {
    "connected": true,
    "hit_rate": 0.75
  }
}</code></pre>
    
        <h2>快捷翻译方法</h2>
    
        <h3>1. 特定语言翻译</h3>
    
        <p>以下方法自动将中文翻译为目标语言：</p>
    
        <pre><code class="language-js">// 翻译到英语
translator.translateToEnglish('你好世界', { fontSize: '24px' })
  .then(result => console.log(result.translatedText));

// 翻译到泰语
translator.translateToThai('你好世界', { fontSize: '32px' })
  .then(result => console.log(result.translatedText));</code></pre>
    
        <p><strong>支持的方法：</strong></p>
        <ul>
          <li><code>translateToIndonesian(text, options)</code> - 翻译到印尼语</li>
          <li><code>translateToMalay(text, options)</code> - 翻译到马来语</li>
          <li><code>translateToFilipino(text, options)</code> - 翻译到菲律宾语</li>
          <li><code>translateToBurmese(text, options)</code> - 翻译到缅甸语</li>
          <li><code>translateToKhmer(text, options)</code> - 翻译到高棉语</li>
          <li><code>translateToLao(text, options)</code> - 翻译到老挝语</li>
          <li><code>translateToThai(text, options)</code> - 翻译到泰语</li>
          <li><code>translateToVietnamese(text, options)</code> - 翻译到越南语</li>
          <li><code>translateToEnglish(text, options)</code> - 翻译到英语</li>
          <li><code>translateToChinese(text, options)</code> - 翻译到中文</li>
          <li><code>translateToTamil(text, options)</code> - 翻译到泰米尔语</li>
        </ul>
    
        <h3>2. 特定语言批量翻译</h3>
    
        <p>以下方法自动批量将中文翻译为目标语言：</p>
    
        <pre><code class="language-js">// 批量翻译到英语
translator.batchTranslateToEnglish([
  { text: '你好', id: 'greeting' },
  { text: '世界', id: 'world' },
  '中国'  // 直接使用字符串也可以
], { fontSize: '24px', maxConcurrent: 5 })
  .then(results => console.log(results));</code></pre>
    
        <p><strong>支持的方法：</strong></p>
        <ul>
          <li><code>batchTranslateToIndonesian(items, options)</code> - 批量翻译到印尼语</li>
          <li><code>batchTranslateToMalay(items, options)</code> - 批量翻译到马来语</li>
          <li><code>batchTranslateToFilipino(items, options)</code> - 批量翻译到菲律宾语</li>
          <li><code>batchTranslateToBurmese(items, options)</code> - 批量翻译到缅甸语</li>
          <li><code>batchTranslateToKhmer(items, options)</code> - 批量翻译到高棉语</li>
          <li><code>batchTranslateToLao(items, options)</code> - 批量翻译到老挝语</li>
          <li><code>batchTranslateToThai(items, options)</code> - 批量翻译到泰语</li>
          <li><code>batchTranslateToVietnamese(items, options)</code> - 批量翻译到越南语</li>
          <li><code>batchTranslateToEnglish(items, options)</code> - 批量翻译到英语</li>
          <li><code>batchTranslateToChinese(items, options)</code> - 批量翻译到中文</li>
          <li><code>batchTranslateToTamil(items, options)</code> - 批量翻译到泰米尔语</li>
        </ul>
    
        <h2>实用示例</h2>
    
        <h3>前端展示翻译结果并设置字体大小</h3>
    
        <pre><code class="language-js">// 单文本翻译
translator.translateToThai('你好世界', { fontSize: '32px' })
  .then(result => {
    const element = document.getElementById('greeting');
    element.innerText = result.translatedText;
    if (result.font_size) {
      element.style.fontSize = result.font_size;
    }
  });

// 批量翻译
translator.batchTranslateToEnglish([
  { text: '你好', id: 'greeting' },
  { text: '世界', id: 'world' }
], { fontSize: '24px' })
  .then(response => {
    // 处理结果
    response.results.forEach(result => {
      const element = document.getElementById(result.id);
      if (element) {
        element.innerText = result.trans_result[0].dst;
        if (response.font_size) {
          element.style.fontSize = response.font_size;
        }
      }
    });
  });</code></pre>
    
        <h3>自定义错误处理</h3>
    
        <pre><code class="language-js">translator.translate('你好', 'zh', 'en')
  .then(result => {
    // 成功处理
    console.log(result.translatedText);
  })
  .catch(error => {
    // 错误处理
    console.error('翻译失败:', error.message);
    showErrorToUser('翻译服务暂时不可用，请稍后再试');
  });</code></pre>
    
        <h2>支持语言列表</h2>
    
        <table>
          <thead>
            <tr>
              <th>语言代码</th>
              <th>语言名称</th>
              <th>方法后缀</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>auto</td>
              <td>自动检测</td>
              <td>-</td>
            </tr>
            <tr>
              <td>zh</td>
              <td>中文</td>
              <td>Chinese</td>
            </tr>
            <tr>
              <td>en</td>
              <td>英语</td>
              <td>English</td>
            </tr>
            <tr>
              <td>id</td>
              <td>印尼语</td>
              <td>Indonesian</td>
            </tr>
            <tr>
              <td>ms</td>
              <td>马来语</td>
              <td>Malay</td>
            </tr>
            <tr>
              <td>fil</td>
              <td>菲律宾语</td>
              <td>Filipino</td>
            </tr>
            <tr>
              <td>my</td>
              <td>缅甸语</td>
              <td>Burmese</td>
            </tr>
            <tr>
              <td>km</td>
              <td>高棉语</td>
              <td>Khmer</td>
            </tr>
            <tr>
              <td>lo</td>
              <td>老挝语</td>
              <td>Lao</td>
            </tr>
            <tr>
              <td>th</td>
              <td>泰语</td>
              <td>Thai</td>
            </tr>
            <tr>
              <td>vie</td>
              <td>越南语</td>
              <td>Vietnamese</td>
            </tr>
            <tr>
              <td>ta</td>
              <td>泰米尔语</td>
              <td>Tamil</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- 英文文档内容 - 初始隐藏 -->
      <div class="plugin-content en hidden-en" id="plugin-doc-english"></div>
    </div>
  </div>

  <!-- 悬浮语言切换器 -->
  <div class="floating-language-switcher">
    <div class="language-toggle">中/英</div>
    <div class="language-options">
      <button class="language-btn active" data-lang="zh">中文</button>
      <button class="language-btn" data-lang="en">English</button>
    </div>
  </div>

  <!-- 加载脚本 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="js/translator.js"></script>
  <script src="js/lazy-translator.js"></script>
  <script>
    // 初始化代码高亮
    hljs.highlightAll();
    
    // 初始化翻译器
    const translator = new BaiduTranslator('/api');
    
    // 获取保存的语言偏好
    const preferredLang = localStorage.getItem('preferred_language') || 'zh';
    console.log("当前语言偏好:", preferredLang);
    
    // 设置对应按钮为激活状态
    const languageBtns = document.querySelectorAll('.language-btn');
    languageBtns.forEach(btn => {
      if (btn.getAttribute('data-lang') === preferredLang) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
    
    // 初始化懒加载翻译器 - 注意：只有非中文语言需要翻译
    const lazyTranslator = new LazyTranslator(translator, {
      fromLang: preferredLang === 'zh' ? 'en' : 'zh',
      toLang: preferredLang,
      selector: '[data-translate]',
      batchSize: 5,
      debounceDelay: 200
    }).init();
    
    // 翻译进度指示器
    const progressIndicator = document.querySelector('.translation-progress');
    
    // 如果初始语言不是中文，显示翻译进度指示器
    if (preferredLang !== 'zh') {
      // 显示翻译进度
      progressIndicator.classList.add('visible');
      
      // 紧急修复 - 直接翻译关键元素
      setTimeout(async () => {
        // 直接翻译几个重要的元素
        console.log("尝试直接翻译关键元素");
        try {
          // 取得所有带data-translate属性的元素
          const transElements = document.querySelectorAll('[data-translate]');
          console.log(`找到${transElements.length}个带翻译属性的元素`);
          
          // 创建批量翻译请求
          const textsToTranslate = [];
          const elementsMap = {};
          
          transElements.forEach((el, idx) => {
            const text = el.textContent.trim();
            if (text) {
              const id = `direct-${idx}`;
              textsToTranslate.push({
                text: text,
                id: id
              });
              elementsMap[id] = el;
            }
          });
          
          if (textsToTranslate.length > 0) {
            console.log(`直接翻译${textsToTranslate.length}个元素...`);
            
            // 调用API翻译
            const result = await translator.batchTranslate(
              textsToTranslate,
              'zh',  // 源语言
              'en'   // 目标语言
            );
            
            console.log("直接翻译返回结果:", result);
            
            // 应用翻译结果
            if (result && result.results) {
              result.results.forEach(item => {
                if (item.trans_result && item.trans_result.length > 0) {
                  const element = elementsMap[item.id];
                  if (element) {
                    const translated = item.trans_result[0].dst;
                    console.log(`直接更新元素: ${item.trans_result[0].src} -> ${translated}`);
                    element.textContent = translated;
                  }
                }
              });
            }
          }
        } catch (err) {
          console.error("直接翻译失败:", err);
        }
      }, 1500);
      
      // 3秒后隐藏进度指示器
      setTimeout(() => {
        progressIndicator.classList.remove('visible');
      }, 3000);
    }
    
    // 语言切换逻辑
    const languageToggle = document.querySelector('.language-toggle');
    const languageOptions = document.querySelector('.language-options');
    
    // 显示语言选项
    languageToggle.addEventListener('click', function() {
      if (languageOptions.style.display === 'block') {
        languageOptions.style.display = 'none';
      } else {
        languageOptions.style.display = 'block';
      }
    });
    
    // 语言切换
    languageBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const lang = this.getAttribute('data-lang');
        
        // 更新按钮状态
        languageBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // 保存语言偏好
        localStorage.setItem('preferred_language', lang);
        
        // 显示翻译进度
        progressIndicator.classList.add('visible');
        
        // 切换翻译器语言
        lazyTranslator.changeLanguage(lang);
        
        // 3秒后隐藏进度指示器
        setTimeout(() => {
          progressIndicator.classList.remove('visible');
        }, 3000);
        
        // 隐藏选项
        languageOptions.style.display = 'none';
      });
    });
    
    // 点击文档其他位置关闭语言选项
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.floating-language-switcher')) {
        languageOptions.style.display = 'none';
      }
    });
  </script>
</body>
</html> 